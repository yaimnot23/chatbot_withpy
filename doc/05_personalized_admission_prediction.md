# 05. 성적 기반 맞춤형 입시 진단 시스템 구현 리포트

본 문서는 로그인한 학생의 성적 데이터를 바탕으로 합격 가능성을 진단하고 코칭해주는 '개인화 입시 진단' 기능의 개발 과정 및 예외 처리 사항을 정리합니다.

---

## 1. 🎯 개발 목표

- 사용자의 수능 표준점수/등급을 입력받아 **추정 누적 백분위(누백)** 산출.
- 대학별 **반영비율(가중치)**을 적용하여 합격 가능성(안정~불가) 진단.
- 목표 대학 합격을 위해 필요한 **부족한 점수(Gap Analysis)** 분석 및 제공.

---

## 2. 🛠️ 주요 구현 내용

### 🐍 Python (AI Server)

- **Scoring Engine**: 표준점수를 상위 % 등수로 변환하는 선형 보간 알고리즘 구현.
- **Admission Diagnosis**: 대학별 가중치 데이터와 사용자 누백을 비교 연산.
- **Context Injection**: 분석 결과를 LLM의 프롬프트 컨텍스트에 주입하여 "전문가 상담" 페르소나 강화.

### 🍃 Spring Boot (Backend)

- **[Option B] 독립 테이블 설계**: 기존 `StudentProfile`을 건드리지 않고 `StudentScore` 테이블을 신규 생성하여 안전성 확보.
- **자동 데이터 연동**: 질문 시 컨트롤러에서 유저 성적을 자동 조회하여 AI 서버로 전송하는 하이브리드 로직 구축.

### 5. AI 페르소나 강화 및 전형 진단관 임명

- **Persona Inertia 문제**: AI가 초기에는 "나는 계산을 못 하니 환산 점수를 직접 알아와라"라며 책임을 회피하는 현상 발생.
- **해결책**: 시스템 프롬프트(System Prompt)를 대폭 수정하여 AI에게 '진단관' 직책을 부여하고, 이미 시스템이 계산한 결과를 '내부 보고서' 형태로 읽어 조언하도록 강제함.

### 6. 벡터 데이터베이스 메타데이터 고도화

- **정밀도 문제**: 단순 텍스트 검색만으로는 대학별 가중치(수학 비중 등)를 AI가 인지하기 어려움.
- **해결책**: `ingest.py`를 수정하여 **[누백, 적정점수, 과목별 비중]** 데이터를 벡터 DB의 메타데이터(Metadata) 영역에 명시적으로 주입. 상담 시 AI가 이 값을 직접 참조하여 가중치 적용 누백을 재계산하도록 로직 개선.

---

## ⚠️ 발생 에러 및 해결 과정 (Troubleshooting)

### 1. 터미널 인코딩 및 엑셀 헤더 인식 문제

- **상황**: 엑셀의 한국어 컬럼명(예: `국어구성비`)이 터미널 환경에서 깨지거나 인식이 안 됨.
- **해결**: `debug_headers.py`를 작성하여 UTF-8 형식으로 헤더 정보를 덤프하고, 이를 바탕으로 정확한 매핑 완료.

### 2. 표준점수-누백 데이터 부재

- **상황**: 성적표에는 누백이 없어 대학 데이터와 직접 비교가 불가능함.
- **해결**: 2026학년도 수능 통계를 바탕으로 한 **추정 환산표(Lookup Table)**를 서버에 내장하여 실시간 변환 로직 구축.

### 3. 데이터 손실 및 회기(Regression) 오류

- **상황**: 코드 수정 과정에서 `context_text` 변수가 누락되어 500 에러 발생.
- **해결**: 즉시 유효성 검사 및 변수 복구를 수행하고 `02_troubleshooting_log.md`에 기록하여 재발 방지.

### 4. 기존 코드 수정 부담 (JPA 리스크)

- **상황**: 이미 다른 팀원이 만든 `StudentProfile`을 수정하면 사이드 이펙트가 발생할 수 있다는 사용자 우려.
- **해결**: **별도 테이블(StudentScore)**을 생성하는 '옵션 B'를 제안 및 적용하여 기존 코드와 완벽히 격리된 안전한 개발 수행.

### 5. AI의 '과잉 겸손'으로 인한 계산 거부 (Persona Inertia)

- **상황**: 점수 분석 로직이 작동함에도 AI가 "나는 환산 점수를 알 수 없다"고 답변함.
- **해결**: 프롬프트에 "계산 능력을 부정하는 것은 시스템 오류"라고 명시하고, 분석 결과를 `### [시스템 내부 성적 진단 보고서]`라는 권위 있는 제목으로 전달하여 무시하지 못하게 함.

### 6. 구글 유료 API 활용 속도 최적화

- **상황**: `ingest.py` 실행 시 속도 제한(Rate Limit)으로 인해 대규모 데이터 처리가 느림.
- **해결**: 사용자님의 유료 계정 환경에 맞춰 배치(Batch) 사이즈를 확대하고 `time.sleep` 대기 시간을 제거하여 인제스트 속도를 5배 이상 향상시킴.

---

## 🚀 최종 결과

- 이제 AI는 "직접 계산해와라"라는 무책임한 말 대신, **"제가 분석한 결과, 합격선에 OO점 부족합니다"**라고 당당하게 조언하는 전문가가 되었습니다.
